<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üç≥ Kitchen Display - ‡∏Ñ‡∏£‡∏±‡∏ß</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  
  <style>
    body {
      font-family: 'Prompt', sans-serif;
    }
    
    .playfair {
      font-family: 'Playfair Display', serif;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
    
    .new-order {
      animation: slideIn 0.5s ease-out, pulse 1s ease-in-out 3;
    }
    
    @keyframes ring {
      0%, 100% { transform: rotate(0deg); }
      10%, 30% { transform: rotate(-10deg); }
      20%, 40% { transform: rotate(10deg); }
    }
    
    .ring {
      animation: ring 0.5s ease-in-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white">
  
  <!-- Header -->
  <header class="bg-slate-900/95 backdrop-blur-lg border-b-2 border-amber-500/30 px-6 py-5 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center shadow-xl shadow-amber-500/30">
          <span class="text-4xl">üç≥</span>
        </div>
        <div>
          <h1 class="playfair text-3xl font-bold text-amber-400">Kitchen Display</h1>
          <p class="text-amber-100/60">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏±‡∏ß</p>
        </div>
      </div>
      
      <div class="flex items-center gap-4">
        <div class="text-right">
          <div class="text-sm text-amber-100/60">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏£‡∏≠‡∏ó‡∏≥</div>
          <div id="pending-count" class="text-3xl font-bold text-amber-400">0</div>
        </div>
        
        <button onclick="toggleSound()" id="sound-btn" class="p-4 rounded-xl bg-slate-800 hover:bg-slate-700 border-2 border-amber-500/30 hover:border-amber-500 transition-all">
          <svg id="sound-icon" class="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Stats Bar -->
  <div class="bg-slate-800/50 border-b border-amber-500/10 px-6 py-4">
    <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-slate-900/50 rounded-xl p-4 border border-amber-500/20">
        <div class="text-amber-100/60 text-sm mb-1">üîî ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        <div id="total-today" class="text-2xl font-bold text-amber-400">0</div>
      </div>
      
      <div class="bg-slate-900/50 rounded-xl p-4 border border-emerald-500/20">
        <div class="text-emerald-100/60 text-sm mb-1">‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</div>
        <div id="completed-count" class="text-2xl font-bold text-emerald-400">0</div>
      </div>
      
      <div class="bg-slate-900/50 rounded-xl p-4 border border-blue-500/20">
        <div class="text-blue-100/60 text-sm mb-1">üí∞ ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        <div id="revenue-today" class="text-2xl font-bold text-blue-400">‡∏ø0</div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="px-6 py-8">
    <div class="max-w-7xl mx-auto">
      
      <!-- Empty State -->
      <div id="empty-state" class="text-center py-20">
        <div class="text-8xl mb-6 opacity-50">üçΩÔ∏è</div>
        <h2 class="text-3xl font-bold text-amber-400 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
        <p class="text-amber-100/50 text-lg">‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤...</p>
      </div>

      <!-- Orders Grid -->
      <div id="orders-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 hidden">
        <!-- Orders will be rendered here -->
      </div>
    </div>
  </main>

  <!-- New Order Notification -->
  <div id="new-order-notification" class="fixed top-24 right-6 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white px-8 py-4 rounded-2xl shadow-2xl shadow-emerald-500/50 hidden z-50">
    <div class="flex items-center gap-3">
      <div class="text-3xl ring">üîî</div>
      <div>
        <div class="font-bold text-lg">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà!</div>
        <div id="notification-table" class="text-sm opacity-90">‡πÇ‡∏ï‡πä‡∏∞ 1</div>
      </div>
    </div>
  </div>

  <!-- Notification Sound -->
  <audio id="notification-sound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBjmV2PHSgjMGHm7A7+OZURE" type="audio/wav">
  </audio>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDlPwb7TmtHigRuGOQ8ddfB27_kmam2fr4",
      authDomain: "foodfood-26.firebaseapp.com",
      databaseURL: "https://foodfood-26-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "foodfood-26",
      storageBucket: "foodfood-26.firebasestorage.app",
      messagingSenderId: "817922519358",
      appId: "1:817922519358:web:17345871b0cc340a08fc6f",
      measurementId: "G-DXJHXXTZ26"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    let soundEnabled = true;
    let orders = {};
    let stats = {
      totalToday: 0,
      completed: 0,
      revenue: 0
    };

    // Listen for new orders
    database.ref('orders').on('child_added', (snapshot) => {
      const order = snapshot.val();
      orders[snapshot.key] = order;
      
      if (order.status === 'pending') {
        showNewOrderNotification(order);
        playNotificationSound();
      }
      
      updateStats();
      renderOrders();
    });

    // Listen for order updates
    database.ref('orders').on('child_changed', (snapshot) => {
      const order = snapshot.val();
      orders[snapshot.key] = order;
      
      updateStats();
      renderOrders();
    });

    // Listen for order removal
    database.ref('orders').on('child_removed', (snapshot) => {
      delete orders[snapshot.key];
      
      updateStats();
      renderOrders();
    });

    function renderOrders() {
      const grid = document.getElementById('orders-grid');
      const emptyState = document.getElementById('empty-state');
      
      const pendingOrders = Object.entries(orders)
        .filter(([_, order]) => order.status === 'pending')
        .sort((a, b) => a[1].timestamp - b[1].timestamp);
      
      if (pendingOrders.length === 0) {
        grid.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      grid.classList.remove('hidden');
      
      grid.innerHTML = pendingOrders.map(([orderId, order]) => {
        const orderTime = new Date(order.timestamp);
        const timeAgo = getTimeAgo(orderTime);
        
        return `
          <div class="bg-slate-800/70 backdrop-blur rounded-2xl border-2 border-amber-500/30 overflow-hidden hover:border-amber-500 transition-all shadow-xl new-order">
            <!-- Order Header -->
            <div class="bg-gradient-to-r from-amber-500/20 to-amber-600/20 px-6 py-4 border-b border-amber-500/20">
              <div class="flex items-start justify-between mb-2">
                <div>
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-3xl">ü™ë</span>
                    <span class="text-3xl font-bold text-amber-400">‡πÇ‡∏ï‡πä‡∏∞ ${order.table}</span>
                  </div>
                  <div class="text-sm text-amber-100/60">
                    <span>‚è∞ ${orderTime.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}</span>
                    <span class="mx-2">‚Ä¢</span>
                    <span>${timeAgo}</span>
                  </div>
                </div>
                
                <div class="text-right">
                  <div class="text-sm text-amber-100/60">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</div>
                  <div class="playfair text-2xl font-bold text-amber-400">‡∏ø${order.total.toLocaleString()}</div>
                </div>
              </div>
            </div>
            
            <!-- Order Items -->
            <div class="p-6 space-y-3 max-h-96 overflow-y-auto">
              ${order.items.map(item => `
                <div class="flex items-center gap-3 bg-slate-900/50 rounded-xl p-4 border border-amber-500/10">
                  <span class="text-4xl">${item.emoji}</span>
                  <div class="flex-1">
                    <div class="font-semibold text-amber-100 text-lg">${item.name}</div>
                    <div class="text-sm text-amber-100/50">${item.desc}</div>
                  </div>
                  <div class="text-center">
                    <div class="w-12 h-12 rounded-full bg-amber-500/20 flex items-center justify-center border-2 border-amber-500">
                      <span class="text-xl font-bold text-amber-400">√ó${item.quantity}</span>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
            
            <!-- Action Buttons -->
            <div class="p-6 border-t border-amber-500/20 bg-slate-900/30">
              <button 
                onclick="completeOrder('${orderId}')" 
                class="w-full py-4 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-bold text-lg rounded-xl shadow-lg shadow-emerald-500/30 hover:shadow-emerald-500/50 transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2"
              >
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                </svg>
                <span>‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</span>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    function completeOrder(orderId) {
      database.ref('orders/' + orderId).update({
        status: 'completed',
        completedAt: new Date().toISOString()
      });
    }

    function updateStats() {
      const today = new Date().toDateString();
      
      const todayOrders = Object.values(orders).filter(order => {
        const orderDate = new Date(order.timestamp).toDateString();
        return orderDate === today;
      });
      
      stats.totalToday = todayOrders.length;
      stats.completed = todayOrders.filter(o => o.status === 'completed').length;
      stats.revenue = todayOrders.reduce((sum, o) => sum + (o.total || 0), 0);
      
      document.getElementById('pending-count').textContent = 
        todayOrders.filter(o => o.status === 'pending').length;
      document.getElementById('total-today').textContent = stats.totalToday;
      document.getElementById('completed-count').textContent = stats.completed;
      document.getElementById('revenue-today').textContent = '‡∏ø' + stats.revenue.toLocaleString();
    }

    function showNewOrderNotification(order) {
      const notification = document.getElementById('new-order-notification');
      const tableText = document.getElementById('notification-table');
      
      tableText.textContent = `‡πÇ‡∏ï‡πä‡∏∞ ${order.table} ‚Ä¢ ${order.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      
      notification.classList.remove('hidden');
      
      setTimeout(() => {
        notification.classList.add('hidden');
      }, 5000);
    }

    function playNotificationSound() {
      if (!soundEnabled) return;
      
      const audio = document.getElementById('notification-sound');
      audio.currentTime = 0;
      audio.play().catch(e => console.log('Audio play failed:', e));
    }

    function toggleSound() {
      soundEnabled = !soundEnabled;
      const icon = document.getElementById('sound-icon');
      const btn = document.getElementById('sound-btn');
      
      if (soundEnabled) {
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>';
        btn.classList.remove('opacity-50');
      } else {
        icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"/>';
        btn.classList.add('opacity-50');
      }
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      if (seconds < 60) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
      if (seconds < 3600) return Math.floor(seconds / 60) + ' ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
      if (seconds < 86400) return Math.floor(seconds / 3600) + ' ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
      return Math.floor(seconds / 86400) + ' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
    }

    // Update time every minute
    setInterval(() => {
      renderOrders();
    }, 60000);
  </script>
</body>
</html>
